<div class="container">
	<div class="row">
		<div id="tab-menu1" class="col-sm-6 col-xs-6">
      <a href="#tab1" class="active col-sm-3 col-xs-3 btn btn-default">店舗情報</a>
      <a href="#tab2" class="col-sm-3 col-xs-3 btn btn-default">レビュー</a>
      <a href="#tab3" class="col-sm-3 col-xs-3 btn btn-default">問合せフォーム</a>
    </div>
    <% if user_signed_in? %>
	    <div class="col-sm-2 col-sm-offset-1">
	      <%= link_to "修理を依頼する", new_users_user_order_path(current_user, on_store_user_id: @shop.id), class: "btn btn-success" %>
	    </div>
	  <% end %>
	</div>

	<div class="row">
		<div class="col-md-8 col-md-offset-2 col-xs-10 col-xs-offset-1">
			<h2 class="font-size4"><%= @shop.shop_name %></h2>
			<div class="row">
				<div class="container-fluid" style="height: 300px; padding: 0;">
					<div class="theTarget">
						<div style="background-image: url(/image1.jpg);"></div>
						<div style="background-image: url(/image3.jpg);"></div>
						<div style="background-image: url(/image4.jpeg);"></div>
					</div>
				</div>
			</div>

			<div id="tab1" class="tab">
				<div class="row">
					<div class="col-sm-12">
						<h3 class="font-size3">ご挨拶</h3>
						<%= @shop.greeting %>
					</div>
				</div>

				<div class="row">
					<h3>サービス概要</h3>
					<div class="col-sm-12 col-xs-12">
						<% if @shop.major_categories.present? %>
							<% @shop.major_categories.each do |major_category| %>
								<div class="row">
									<div class="col-sm-3">
										<%= major_category.name %>
									</div>
									<% major_category.middle_categories.each_with_index do |middle_category, i| %>
										<% if i == 0 %>
											<div class="col-sm-9">
										<% else %>
											<div class="col-sm-9 col-sm-offset-3">
										<% end %>
											<div class="col-sm-5">
												<%= middle_category.name %>
											</div>
											<div class="col-sm-7">
												<% middle_category.minor_categories.each do |minor_category| %>
													<div class="col-sm-6">
														<%= minor_category.name %>
													</div>
													<div class="col-sm-6">
														<%= minor_category.quote %>
													</div>
												<% end %>
											</div>
										</div>
									<% end %>
								</div>
							<% end %>
						<% else %>
							未登録
						<% end %>
					</div>
				</div>

				<div class="row">
					<div class="col-sm-12">
						<h3 class="font-size3">店舗情報</h3>
						<table class="table font-size2">
							<tbody>
								<tr>
									<td class="cell-title">営業時間</td>
									<td class="cell-body"><%= @shop.business_hours %></td>
								</tr>
								<tr>
									<td class="cell-title">定休日</td>
									<td class="cell-body"><%= @shop.holiday %></td>
								</tr>
								<tr>
									<td class="cell-title">電話番号</td>
									<td class="cell-body"><%= @shop.telephone_number %></td>
								</tr>
								<tr>
									<td class="cell-title">最寄駅</td>
									<td class="cell-body"><%= @shop.closest_station %></td>
								</tr>
								<tr>
									<td class="cell-title">住所</td>
									<td class="cell-body"><%= @shop.postcode %></td>
								</tr>
								<tr>
									<td class="cell-title" style="border: none;"></td>
									<td class="cell-body" style="border: none; "><%= @shop.address %></td>
								</tr>
								<tr>
									<td class="cell-title" style="border: none;"></td>
									<td class="cell-body" style="border: none;"><p class="btn btn-default" style="background-color: blue; color: white;">Google MAP</p></td>
								</tr>
								<tr>
									<td class="cell-title">駐車場</td>
									<td class="cell-body"><%= @shop.parking %></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>

			<div id="tab2" class="tab">
				<div>
					<% if @shop.reviews.count != 0 %>
						<table class="table">
							<tbody>
								<% @shop.reviews.reverse.each_with_index do |review, index| %>
									<tr>
										<td><%= review.title %></td>
										<td><%= review.created_at.strftime("%Y/%m/%d(#{%w(日 月 火 水 木 金 土)[review.created_at.wday]}) %H:%M") %></td>
									</tr>
									<tr>
										<% if review.body.length > 300 %>
											<td colspan="2" id="limit-body-<%= index %>"><%= review.body[0..300] %> ...</td>
										<% else %>
											<td colspan="2"><%= review.body %></td>
										<% end %>
									</tr>
									<tr style="display: none;" id="body-<%= index %>">
										<td colspan="2"><%= review.body %></td>
									</tr>
									<% if review.body.length > 300 %>
										<tr class="trigger-<%= index %>">
											<td></td>
											<td>全文を表示</td>
										</tr>
										<tr style="display: none;" class="trigger-<%= index %>">
											<td></td>
											<td>　 戻す</td>
										</tr>
									<% end %>

									<script>
										$('.trigger-<%= index %>').on('click', function() {
     										$('#limit-body-<%= index %>').toggle();
    										$('#body-<%= index %>').toggle();
    										$('.trigger-<%= index %>').toggle();
    										return false;
  									});
									</script>
								<% end %>
							</tbody>
						</table>
					<% else %>
						<div>
							<p>まだレビューはありません</p>
						</div>
					<% end %>
				</div>
			</div>

			<div id="tab3" class="tab inquiries">
				<% if user_signed_in? %>
					<%= render '/shared/inquiries/inquiry', inquiries: @inquiries, shop: @shop %>
				<% else %>
					ログイン後にお問合せ出来ます
					ログインは<%= link_to "こちら", new_user_session_path %>
					新規登録は<%= link_to "こちら", new_user_registration_path %>
				<% end %>
			</div>

		</div>
	</div>
</div>

<script>
	$('document').on('turbolinks:load', function(){
		$('.theTarget').skippr();
	});

	$('.theTarget').skippr({
		// "fade" or "slide"
		transition: 'fade',
		speed: 1000,
		// easingの種類
		easing: 'easeOutQuart',
		// "block" or "bubble"
		navType: 'bubble',
		// "div" or "img"
		childrenElementType: 'div',
		arrows: true,
		// スライドショーの自動再生
		autoPlay: true,
		autoPlayDuration: 4000,
	// キーボードの矢印キーによるスライド送りの設定
		keyboardOnAlways: true,
	// 1枚目のスライド表示時に戻る矢印を表示するか
		hidePrevious: false
	});

	$('.tab[id != "tab1"]').hide();

	$('#tab-menu1 a').on('click', function() {
  	$(".tab").hide();
  	$("#tab-menu1 .active").removeClass("active");
  	$(this).addClass("active");
  	$($(this).attr("href")).show();
  	return false;
	});
</script>